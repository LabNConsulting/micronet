topology:
  networks-autonumber: true
  dns-network: "mgmt0"
  networks:
    - name: mgmt0
      ip: 192.168.0.254/24
      nat: true
  nodes:
    - name: h1
      connections: ["mgmt0"]
    # - name: h2
    #   kind: linux
    #   connections: ["mgmt0"]
    - name: r1
      kind: ubuntu
      connections:
        - to: "mgmt0"
          name: "ens3"

kinds:
  - name: linux
    qemu:
      kernel: "%CONFIGDIR%/bzImage"
      initrd: "%CONFIGDIR%/rootfs.cpio.gz"
      cmdline-extra: "acpi=off nokaslr"
      memory: "768M"
      kvm: true
      ncpu: 2

  - name: ubuntu
    qemu:
      disk-templates:
        - path: "%CONFIGDIR%/images/jammy-server-cloudimg-amd64-disk-kvm.img"
          size: "20G"
      data-disk: "%CONFIGDIR%/user-data.img"
      cmdline-extra: "acpi=off nokaslr"
      memory: "768M"
      kvm: true
      ncpu: 2
      console:
        stdio: true
        user: "root"
        password: "admin"
        timeout: 300

cli:
  commands:
    - name: con
      exec: "socat /dev/stdin,rawer,escape=0x1d,,echo=0,icanon=0 unix-connect:/tmp/qemu-sock/console"
      format: "con HOST [HOST ...]"
      help: "open console on given hosts, * for all"
      new-window: true
    - name: _con
      exec: "socat /dev/stdin,rawer,escape=0x1d,,echo=0,icanon=0 unix-connect:/tmp/qemu-sock/_console"
      format: "_con HOST [HOST ...]"
      help: "open console on given hosts, * for all"
      new-window: true
    - name: vcon
      exec: "socat /dev/stdin,rawer,escape=0x1d,,echo=0,icanon=0 unix-connect:/tmp/qemu-sock/vcon0"
      format: "vcon HOST [HOST ...]"
      help: "open console on given hosts, * for all"
      new-window: true
    - name: mon
      exec: "socat /dev/stdin,rawer,escape=0x1d,,echo=0,icanon=0 unix-connect:/tmp/qemu-sock/monitor"
      format: "mon NODE [NODE ...]"
      help: "open monitor on given hosts, * for all"
      new-window: true
    - name: ssh
      exec: "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null %IPADDR%"
      kinds: ["linux"]
      format: "ssh NODE [NODE ...]"
      top-level: true
      new-window: true
    - name: sship
      exec: "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null {}"
      format: "sship [user@]ip-addr"
      top-level: true
      new-window: true
    - name: vtysh
      exec: "expect -c 'spawn ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null %IPADDR% ; expect \"assword:\"; send \"\n\"; interact'"
      format: "vtysh NODE"
      top-level: true
      new-window: true
