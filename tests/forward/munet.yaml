#
#   +------+                   +------+                   +------+
#   |      |    10.0.1.0/24    |      |    10.0.2.0/24    |      |
#   |  r1  | ----------------- |  r2  | ----------------- |  r3  |
#   |      |.1     net1      .2|      |.2     net2      .3|      |
#   +------+                   +------+                   +------+
#
version: 1
kinds:
  - name: frr
    cmd: |
      chown frr:frr -R /var/run/frr
      chown frr:frr -R /var/log/frr
      /usr/lib/frr/frrinit.sh start
      tail -F /var/log/frr/frr.log
    cleanup-cmd: |
      /usr/lib/frr/frrinit.sh stop
    volumes:
      - "./%NAME%/etc.frr:/etc/frr"
      - "%RUNDIR%/var.log.frr:/var/log/frr"
      - "%RUNDIR%/var.run.frr:/var/run/frr"
    cap-add:
      - SYS_ADMIN
      - AUDIT_WRITE
    merge: ["volumes"]
topology:
  ipv6-enable: true
  networks-autonumber: true
  networks:
    - name: net1
    - name: net2
  nodes:
    - name: r1
      kind: frr
      connections: ["net1"]
    - name: r2
      kind: frr
      connections: ["net1", "net2"]
    - name: r3
      kind: frr
      connections: ["net2"]
cli:
  commands:
    - name: ""
      exec: "vtysh -c '{}'"
      format: "[ROUTER ...] COMMAND"
      help: "execute vtysh COMMAND on the router[s]"
      kinds: ["frr"]
    - name: "vtysh"
      exec: "/usr/bin/vtysh"
      format: "vtysh ROUTER [ROUTER ...]"
      new-window: true
      kinds: ["frr"]
